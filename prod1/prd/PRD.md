# PRD — Crypto Tracker (Production)

## 1) Цель
Надёжно учитывать ERC-20 вход/выход по пулу управляемых кошельков и давать корректную операционную отчётность (транзакции, сводка, балансы).

## 2) Пользователи и роли
- **admin** — управляет кошельками/тегами/whitelist, запускает sync.
- **read_only** — только просмотр.

## 3) Scope (текущий)
- Сеть: Ethereum
- Активы: ERC-20
- Источник: Etherscan API
- Данные:
  - ledger транзакций (`Erc20Transfer`)
  - текущие балансы Etherscan (`EtherscanTokenBalance`)
- UI: Обзор, Кошельки, Транзакции, Сводка, balanceLedger, balanceEtherscan, Теги, Настройки.

## 4) Критичные бизнес-правила
1. Self-transfer (`from == to == wallet`) не должен влиять на отчёты.
2. `summary` строится по ledger (`Erc20Transfer`), не по live-запросу в Etherscan.
3. `balanceEtherscan` хранится в БД (не в RAM), чтобы не теряться при рестарте.
4. Любое изменение в расчётах должно сопровождаться обновлением runbook/ADR.

## 5) Нефункциональные требования
- Корректность: сводка консистентна с ledger.
- Наблюдаемость: видимый статус sync + логи.
- Восстановление: rollback на предыдущий deploy в Render.
- Безопасность: роли + валидация входных данных.

## 6) Definition of Done
- Код + smoke-check
- Обновлены docs в `prod1/`
- Обновлён changelog
- Подтверждён healthcheck и базовые проверки UI/API в проде
